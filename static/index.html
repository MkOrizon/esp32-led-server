<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ESP32 LED Control</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; padding: 50px; background: #111; color: #fff; }
  h1 { color: #00ff88; }
  #status { font-size: 2em; margin: 20px; }
  button { padding: 15px 30px; font-size: 1.5em; cursor: pointer; border: none; border-radius: 10px; }
  #toggleBtn { background: #ff5555; color: #fff; }
  #toggleBtn.on { background: #00ff88; color: #000; }
</style>
</head>
<body>
<h1>ESP32 LED Control</h1>
<div id="status">Loading...</div>
<button id="toggleBtn" onclick="toggleLED()">Toggle LED</button>

<script>
const API_BASE = "https://esp32-led-server-production.up.railway.app";

async function loadState() {
    try {
        const response = await fetch(`${API_BASE}/state`);
        const data = await response.json();
        updateUI(data.status);
    } catch (e) {
        document.getElementById("status").innerText = "Error connecting...";
    }
}

async function toggleLED() {
    try {
        const response = await fetch(`${API_BASE}/toggle`, { method: "POST" });
        const data = await response.json();
        updateUI(data.status);
    } catch (e) {
        alert("Failed to toggle LED");
    }
}

function updateUI(state) {
    const statusDiv = document.getElementById("status");
    const toggleBtn = document.getElementById("toggleBtn");
    if (state.toLowerCase() === "on") {
        statusDiv.innerText = "LED is ON";
        toggleBtn.classList.add("on");
    } else {
        statusDiv.innerText = "LED is OFF";
        toggleBtn.classList.remove("on");
    }
}

// Initial load and refresh every 3 seconds
loadState();
setInterval(loadState, 500);
</script>
</body>
</html>
