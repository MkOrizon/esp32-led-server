<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M.K TECh - Control Panel</title>

    <!-- EXTERNAL CSS -->
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<header>M.K TECH</header>

<div class="container">

    <!-- LED 1 -->
    <div class="control-card">
        <h2>LED 1</h2>
        <label class="switch">
            <input type="checkbox" id="led1" onchange="toggleLEDSwitch('led1')">
            <span class="slider"></span>
        </label>
    </div>

    <!-- LED 2 -->
    <div class="control-card">
        <h2>LED 2</h2>
        <label class="switch">
            <input type="checkbox" id="led2" onchange="toggleLEDSwitch('led2')">
            <span class="slider"></span>
        </label>
    </div>

    <!-- LED 3 -->
    <div class="control-card">
        <h2>LED 3</h2>
        <label class="switch">
            <input type="checkbox" id="led3" onchange="toggleLEDSwitch('led3')">
            <span class="slider"></span>
        </label>
    </div>

    <!-- LED 4 -->
    <div class="control-card">
        <h2>LED 4</h2>
        <label class="switch">
            <input type="checkbox" id="led4" onchange="toggleLEDSwitch('led4')">
            <span class="slider"></span>
        </label>
    </div>

    <!-- RELAY -->
    <div class="control-card">
        <h2>Relay</h2>
        <label class="switch">
            <input type="checkbox" id="relay" onchange="toggleRelay()">
            <span class="slider"></span>
        </label>
    </div>

    <!-- SERVO -->
    <div class="control-card">
        <h2>Servo Control</h2>
        <button onclick="moveServo('left')">Move Left (0°)</button>
        <button onclick="moveServo('center')">Center (90°)</button>
        <button onclick="moveServo('right')">Move Right (180°)</button>
    </div>

</div>

<script>
/* ================================
   LOAD STATES ON PAGE LOAD
================================ */
async function loadStates() {
    try {
        const res = await fetch("/state_all");
        const data = await res.json();

        // LEDs
        for (let i = 1; i <= 4; i++) {
            const id = "led" + i;
            document.getElementById(id).checked = (data[id] === "on");
        }

        // Relay
        document.getElementById("relay").checked = (data["relay"] === "on");

    } catch (err) {
        console.error("Failed to load states:", err);
    }
}

/* ================================
   TOGGLE LED
================================ */
async function toggleLEDSwitch(ledID) {
    try {
        const checkbox = document.getElementById(ledID);
        const state = checkbox.checked ? "on" : "off";
        await fetch(`/led/${ledID}/${state}`);
    } catch (err) {
        alert("Connection error — server unreachable.");
    }
}

/* ================================
   TOGGLE RELAY
================================ */
async function toggleRelay() {
    try {
        const relayBox = document.getElementById("relay");
        const state = relayBox.checked ? "on" : "off";
        await fetch(`/relay/${state}`);
    } catch (err) {
        alert("Connection error — server unreachable.");
    }
}

/* ================================
   SERVO CONTROL
================================ */
async function moveServo(position) {
    try {
        const res = await fetch(`/servo/${position}`);
        const data = await res.json();
        alert(`✔ Servo moved to: ${data.position.toUpperCase()}`);
    } catch (err) {
        alert("Connection error — server unreachable.");
    }
}

// INITIAL LOAD
loadStates();
</script>

</body>
</html>
