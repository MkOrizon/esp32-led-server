<script>
const API_BASE = "https://esp32-led-server-production.up.railway.app";

// Load current LED state and update UI
async function loadState() {
    try {
        const response = await fetch(`${API_BASE}/state`);
        const data = await response.json();
        updateUI(data.status); // make sure it matches 'on'/'off'
    } catch (e) {
        document.getElementById("status").innerHTML = "Error connecting...";
    }
}

// Toggle LED on the server
async function toggleLED() {
    try {
        const response = await fetch(`${API_BASE}/toggle`, { method: "POST" }); // must be POST
        const data = await response.json();
        updateUI(data.status);
    } catch (e) {
        alert("Failed to toggle LED");
    }
}

// Update the UI
function updateUI(state) {
    const statusDiv = document.getElementById("status");
    if (state.toLowerCase() === "on") {
        statusDiv.innerHTML = "LED is ON";
        statusDiv.style.color = "#00ff88"; // green
    } else {
        statusDiv.innerHTML = "LED is OFF";
        statusDiv.style.color = "#ff5555"; // red
    }
}

// Initial load
loadState();

// Optional: refresh state every 3 seconds
setInterval(loadState, 3000);
</script>
